{"ast":null,"code":"import { RpcRequestError } from '../../errors/request.js';\nimport { UrlRequiredError } from '../../errors/transport.js';\nimport { getSocket, rpc } from '../../utils/rpc.js';\nimport { createTransport } from './createTransport.js';\n/**\n * @description Creates a WebSocket transport that connects to a JSON-RPC API.\n */\nexport function webSocket( /** URL of the JSON-RPC API. Defaults to the chain's public RPC URL. */\nurl, config = {}) {\n  const {\n    key = 'webSocket',\n    name = 'WebSocket JSON-RPC',\n    retryDelay\n  } = config;\n  return ({\n    chain,\n    retryCount: retryCount_,\n    timeout: timeout_\n  }) => {\n    const retryCount = config.retryCount ?? retryCount_;\n    const timeout = timeout_ ?? config.timeout ?? 10000;\n    const url_ = url || chain?.rpcUrls.default.webSocket?.[0];\n    if (!url_) throw new UrlRequiredError();\n    return createTransport({\n      key,\n      name,\n      async request({\n        method,\n        params\n      }) {\n        const body = {\n          method,\n          params\n        };\n        const socket = await getSocket(url_);\n        const {\n          error,\n          result\n        } = await rpc.webSocketAsync(socket, {\n          body,\n          timeout\n        });\n        if (error) throw new RpcRequestError({\n          body,\n          error,\n          url: url_\n        });\n        return result;\n      },\n      retryCount,\n      retryDelay,\n      timeout,\n      type: 'webSocket'\n    }, {\n      getSocket() {\n        return getSocket(url_);\n      },\n      async subscribe({\n        params,\n        onData,\n        onError\n      }) {\n        const socket = await getSocket(url_);\n        const {\n          result: subscriptionId\n        } = await new Promise((resolve, reject) => rpc.webSocket(socket, {\n          body: {\n            method: 'eth_subscribe',\n            params\n          },\n          onResponse(response) {\n            if (response.error) {\n              reject(response.error);\n              onError?.(response.error);\n              return;\n            }\n            if (typeof response.id === 'number') {\n              resolve(response);\n              return;\n            }\n            if (response.method !== 'eth_subscription') return;\n            onData(response.params);\n          }\n        }));\n        return {\n          subscriptionId,\n          async unsubscribe() {\n            return new Promise(resolve => rpc.webSocket(socket, {\n              body: {\n                method: 'eth_unsubscribe',\n                params: [subscriptionId]\n              },\n              onResponse: resolve\n            }));\n          }\n        };\n      }\n    });\n  };\n}","map":{"version":3,"names":["RpcRequestError","UrlRequiredError","getSocket","rpc","createTransport","webSocket","url","config","key","name","retryDelay","chain","retryCount","retryCount_","timeout","timeout_","url_","rpcUrls","default","request","method","params","body","socket","error","result","webSocketAsync","type","subscribe","onData","onError","subscriptionId","Promise","resolve","reject","onResponse","response","id","unsubscribe"],"sources":["/Users/envyhose/Desktop/programs/keepsafe_repo/keepsafe/client/node_modules/viem/clients/transports/webSocket.ts"],"sourcesContent":["import type { WebSocket } from 'isomorphic-ws'\n\nimport { RpcRequestError } from '../../errors/request.js'\nimport { UrlRequiredError } from '../../errors/transport.js'\nimport type { Hash } from '../../types/misc.js'\nimport { type RpcResponse, getSocket, rpc } from '../../utils/rpc.js'\nimport {\n  type Transport,\n  type TransportConfig,\n  createTransport,\n} from './createTransport.js'\n\ntype WebSocketTransportSubscribeParameters = {\n  onData: (data: RpcResponse) => void\n  onError?: (error: any) => void\n}\n\ntype WebSocketTransportSubscribeReturnType = {\n  subscriptionId: Hash\n  unsubscribe: () => Promise<RpcResponse<boolean>>\n}\n\ntype WebSocketTransportSubscribe = {\n  subscribe(\n    args: WebSocketTransportSubscribeParameters & {\n      /**\n       * @description Add information about compiled contracts\n       * @link https://hardhat.org/hardhat-network/docs/reference#hardhat_addcompilationresult\n       */\n      params: ['newHeads']\n    },\n  ): Promise<WebSocketTransportSubscribeReturnType>\n}\n\nexport type WebSocketTransportConfig = {\n  /** The key of the WebSocket transport. */\n  key?: TransportConfig['key']\n  /** The name of the WebSocket transport. */\n  name?: TransportConfig['name']\n  /** The max number of times to retry. */\n  retryCount?: TransportConfig['retryCount']\n  /** The base delay (in ms) between retries. */\n  retryDelay?: TransportConfig['retryDelay']\n  /** The timeout (in ms) for async WebSocket requests. Default: 10_000 */\n  timeout?: TransportConfig['timeout']\n}\n\nexport type WebSocketTransport = Transport<\n  'webSocket',\n  {\n    getSocket(): Promise<WebSocket>\n    subscribe: WebSocketTransportSubscribe['subscribe']\n  }\n>\n\n/**\n * @description Creates a WebSocket transport that connects to a JSON-RPC API.\n */\nexport function webSocket(\n  /** URL of the JSON-RPC API. Defaults to the chain's public RPC URL. */\n  url?: string,\n  config: WebSocketTransportConfig = {},\n): WebSocketTransport {\n  const { key = 'webSocket', name = 'WebSocket JSON-RPC', retryDelay } = config\n  return ({ chain, retryCount: retryCount_, timeout: timeout_ }) => {\n    const retryCount = config.retryCount ?? retryCount_\n    const timeout = timeout_ ?? config.timeout ?? 10_000\n    const url_ = url || chain?.rpcUrls.default.webSocket?.[0]\n    if (!url_) throw new UrlRequiredError()\n    return createTransport(\n      {\n        key,\n        name,\n        async request({ method, params }) {\n          const body = { method, params }\n          const socket = await getSocket(url_)\n          const { error, result } = await rpc.webSocketAsync(socket, {\n            body,\n            timeout,\n          })\n          if (error)\n            throw new RpcRequestError({\n              body,\n              error,\n              url: url_,\n            })\n          return result\n        },\n        retryCount,\n        retryDelay,\n        timeout,\n        type: 'webSocket',\n      },\n      {\n        getSocket() {\n          return getSocket(url_)\n        },\n        async subscribe({ params, onData, onError }: any) {\n          const socket = await getSocket(url_)\n          const { result: subscriptionId } = await new Promise<any>(\n            (resolve, reject) =>\n              rpc.webSocket(socket, {\n                body: {\n                  method: 'eth_subscribe',\n                  params,\n                },\n                onResponse(response) {\n                  if (response.error) {\n                    reject(response.error)\n                    onError?.(response.error)\n                    return\n                  }\n\n                  if (typeof response.id === 'number') {\n                    resolve(response)\n                    return\n                  }\n                  if (response.method !== 'eth_subscription') return\n                  onData(response.params)\n                },\n              }),\n          )\n          return {\n            subscriptionId,\n            async unsubscribe() {\n              return new Promise<any>((resolve) =>\n                rpc.webSocket(socket, {\n                  body: {\n                    method: 'eth_unsubscribe',\n                    params: [subscriptionId],\n                  },\n                  onResponse: resolve,\n                }),\n              )\n            },\n          }\n        },\n      },\n    )\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}